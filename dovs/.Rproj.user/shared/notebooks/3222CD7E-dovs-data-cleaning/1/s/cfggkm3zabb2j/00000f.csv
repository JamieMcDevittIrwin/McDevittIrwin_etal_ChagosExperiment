"0","#### Sum of Species Counts ####"
"0","###############################"
"0","# Add up the counts for each species at each DOV op code_transect"
"0","# since the data has multiple species throughout different times of the video"
"0","dovs.sum <- dovs %>% "
"0","  group_by(Atoll, Location, Site, Year, OpCode_Site,OpCode,OpCode_transect, Full.Species.Name) %>%"
"0","  summarize(Abundance= sum(Number)) %>% # sum up the number of individuals for each species"
"0","  ungroup() # always need to ungroup after group_by so you can mutate that variable if you need to"
"2","`summarise()` has grouped output by 'Atoll', 'Location', 'Site', 'Year', 'OpCode_Site', 'OpCode', 'OpCode_transect'. You can override using the `.groups` argument."
"0","#### Wide Data ####"
"0","###################"
"0","# Get NAn values for every species that was not recorded at an OpCode_transect, this creates a wide site by species matrix"
"0","dovs.wide <- reshape2::dcast(dovs.sum, Atoll + OpCode + OpCode_Site + "
"0","                               Location + Site + Year + OpCode_transect "
"0","                             ~ Full.Species.Name, value.var = 'Abundance')"
"0","dovs.wide <- as.data.frame(dovs.wide)"
"0","dovs.wide[is.na(dovs.wide)] <- 0 # convert these NAn to zero"
"0",""
"0","# Rename the baitfish column that were unidentified"
"0","colnames(dovs.wide)[8] = ""Unidentified baitfish"""
"0",""
"0","# Create a new column based on shark abundance (cat and cont)"
"0","dovs.wide <- dovs.wide %>% "
"0","  mutate(Shark_Abundance= ifelse(Atoll %in% ""Egmont"", ""High"", ifelse(Atoll %in% ""Salomon"", ""Medium"", ""Low""))) %>% "
"0","  mutate(Shark_Sum_Abundance= ifelse(Atoll %in% ""Egmont"", 6.9, ifelse(Atoll %in% ""Salomon"", 4.8, ifelse(Atoll %in% ""Peros Banhos"", 3.8, ifelse(Atoll %in% ""Brothers"", 2.9, 3.1)))))"
"0",""
"0","dovs.wide$Shark_Abundance <- factor(dovs.wide$Shark_Abundance,levels = c(""Low"", ""Medium"", ""High"")) # reorder"
"0",""
"0","dovs.wide$Atoll <- factor(dovs.wide$Atoll,levels = c(""Nelsons Island"", ""Brothers"", ""Peros Banhos"", ""Salomon"", ""Egmont"")) # reorder"
"0",""
"0","dovs.wide$Shark_Sum_Abundance <-as.numeric(dovs.wide$Shark_Sum_Abundance)"
"0",""
"0",""
"0",""
"0","#### Long Data ####"
"0","###################"
"0","dovs.long <- reshape2::melt(dovs.wide, "
"0","                            id.vars=c('Year','Atoll', 'Location', ""Site"", ""OpCode_transect"",""OpCode_Site"", ""OpCode"", ""Shark_Abundance"", ""Shark_Sum_Abundance""), "
"0","                            value.name= ""Abundance"", "
"0","                            variable.name= ""Full.Species.Name"") %>% "
"0","  mutate(Family= word(Full.Species.Name, 1))"
"0",""
"0",""
"0",""
"0",""
"0",""
"0","# Family Level Data"
"0","dovs.wide.family <- dovs.long %>%"
"0","  # filter out herbivores, corallivores and mesopredators"
"0","  filter(Family %in% c(""Scaridae"", ""Acanthuridae"", ""Chaetodontidae"", ""Lutjanidae"", ""Lethrinidae"", ""Haemulidae"",""Serranidae"")) %>% "
"0","  # group by and summarize for each transect"
"0","  group_by(OpCode_transect, OpCode_Site, Site, Atoll, Family, Shark_Sum_Abundance) %>% "
"0","  summarize(sum= sum(Abundance)) %>%"
"0","  # make it a wide df"
"0","  pivot_wider(names_from= Family, values_from= sum) %>%"
"0","  # add up mesopredators and herbivores"
"0","    mutate(Mesopredators = Serranidae + Haemulidae + Lutjanidae + Lethrinidae) %>%"
"0","  mutate(Herbivores = Scaridae + Acanthuridae)"
"2","`summarise()` has grouped output by 'OpCode_transect', 'OpCode_Site', 'Site', 'Atoll', 'Family'. You can override using the `.groups` argument."
"0","dovs.wide.family <- as.data.frame(dovs.wide.family)"
"0",""
