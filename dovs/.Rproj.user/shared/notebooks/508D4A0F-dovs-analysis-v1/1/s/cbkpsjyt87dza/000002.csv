"0","# Mutate to get counts for each species at each DOV op code"
"0","dovs.2 <- dovs %>% "
"0","  group_by(Atoll, Location, Site, Year, OpCode_transect, Full.Species.Name) %>%"
"0","  summarize(Abundance= sum(Number)) %>% # sum up the number of individuals for each species"
"0","  ungroup() # always need to ungroup after group_by so you can mtuate that variable if you need to"
"0","# sum up the number of individuals for each species"
"0",""
"0",""
"0","# Get NAn values for every species that was not recorded at an OpCode_transect, this creates a wide site by species matrix"
"0","dovs.wide <- reshape2::dcast(dovs.2, Atoll + Location + Site + Year + OpCode_transect ~ Full.Species.Name, value.var = 'Abundance')"
"0",""
"0","dovs.wide <- as.data.frame(dovs.wide)"
"0",""
"0","dovs.wide[is.na(dovs.wide)] <- 0"
"0",""
"0","# rename the baitfish column that were unidentified"
"0","colnames(dovs.wide)[6] = ""Unidentified baitfish"""
"0",""
"0",""
"0","# Create a long version"
"0","dovs.long <- reshape2::melt(dovs.wide, id.vars=c('Year','Atoll', 'Location', ""Site"", ""OpCode_transect""), value.name= ""Abundance"", variable.name= ""Full.Species.Name"")"
"0",""
"0","# add family back in"
"0","family <- dovs %>%"
"0","  select(Family, Full.Species.Name)"
"0",""
"0","dovs.long <- dovs.long %>%"
"0","  left_join(family)"
"2","Joining, by = ""Full.Species.Name""
"
"2","Column `Full.Species.Name` joining factor and character vector, coercing into character vector"
"0","# new column based on shark abundance (low vs high)"
"0","dovs.long <- dovs.long %>% mutate(Shark_Abundance= ifelse(Atoll %in% ""Egmont"", ""High"", ifelse(Atoll %in% ""Salomon"", ""Medium"", ""Low"")))"
"0",""
"0","dovs.wide <- dovs.wide %>% mutate(Shark_Abundance= ifelse(Atoll %in% ""Egmont"", ""High"", ifelse(Atoll %in% ""Salomon"", ""Medium"", ""Low""))) "
"0",""
"0","dovs.long$Atoll <- factor(dovs.long$Atoll,levels = c(""Brothers"",""Nelsons Island"",""Peros Banhos"",""Salomon"", ""Egmont""))"
"0",""
"0","dovs.long$Shark_Abundance <- factor(dovs.long$Shark_Abundance,levels = c(""Low"", ""Medium"", ""High""))"
"0",""
"0","dovs.wide$Shark_Abundance <- factor(dovs.wide$Shark_Abundance,levels = c(""Low"", ""Medium"", ""High""))"
"0",""
"0","# Create a new DF without the lagoonal sites"
"0","dovs.wide.reef <- dovs.wide %>%"
"0","  filter(!OpCode_transect %in% c(""BIOT_7097_DOV_6_Salomon_N_20190311.T1"",""BIOT_7097_DOV_6_Salomon_N_20190311.T2"",""BIOT_7097_DOV_6_Salomon_N_20190311.T3"",""BIOT_7097_DOV_6_Salomon_N_20190311.T4"",""BIOT_7097_DOV_7_PerosBanhos_Lagoon_20190303.T1"",""BIOT_7097_DOV_7_PerosBanhos_Lagoon_20190303.T2"",""BIOT_7097_DOV_7_PerosBanhos_Lagoon_20190303.T3"",""BIOT_7097_DOV_7_PerosBanhos_Lagoon_20190303.T4""))%>% "
"0","  select_if(negate(function(col) is.numeric(col) && sum(col) < 1)) # get rid of any species that don't occur in teh dataset"
"0",""
"0","dovs.long.reef <- reshape2::melt(dovs.wide.reef, id.vars=c('Year','Atoll', 'Location', ""Site"", ""OpCode_transect"", ""Shark_Abundance""), value.name= ""Abundance"", variable.name= ""Full.Species.Name"")"
"0",""
"0","# add family to dovs.long.reef"
"0","dovs.long.reef <- dovs.long.reef %>% mutate(Family= word(dovs.long.reef$Full.Species.Name, 1))"
"0",""
"0","# reorder"
"0","dovs.long.reef <- dovs.long.reef %>% select(1:6,9,7,8) "
