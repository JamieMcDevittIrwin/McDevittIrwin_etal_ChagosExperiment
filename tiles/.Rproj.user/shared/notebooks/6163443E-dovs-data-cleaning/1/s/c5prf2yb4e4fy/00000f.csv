"0","#### Sum of Species Counts ####"
"0","# Add up the counts for each species at each DOV op code_transect"
"0","# since the data has multipel species throghout different times of the video"
"0","dovs.sum <- dovs %>% "
"0","  group_by(Atoll, Location, Site, Year, OpCode_Site,OpCode,OpCode_transect, Full.Species.Name) %>%"
"0","  summarize(Abundance= sum(Number)) %>% # sum up the number of individuals for each species"
"0","  ungroup() # always need to ungroup after group_by so you can mtuate that variable if you need to"
"1","`summarise()` has grouped output by 'Atoll', 'Location', 'Site', 'Year', 'OpCode_Site', 'OpCode', 'OpCode_transect'. You can override using the `.groups` argument.
"
"0","#### Wide Data ####"
"0","# Get NAn values for every species that was not recorded at an OpCode_transect, this creates a wide site by species matrix"
"0","dovs.wide <- reshape2::dcast(dovs.sum, Atoll + OpCode +OpCode_Site + Location + Site + Year + OpCode_transect ~ Full.Species.Name, value.var = 'Abundance')"
"0","dovs.wide <- as.data.frame(dovs.wide)"
"0","dovs.wide[is.na(dovs.wide)] <- 0 # convert these NAn to zero"
"0",""
"0","# Rename the baitfish column that were unidentified"
"0","colnames(dovs.wide)[8] = ""Unidentified baitfish"""
"0",""
"0","# Create a new column based on shark abundance (cat and cont)"
"0","dovs.wide <- dovs.wide %>% "
"0","  mutate(Shark_Abundance= ifelse(Atoll %in% ""Egmont"", ""High"", ifelse(Atoll %in% ""Salomon"", ""Medium"", ""Low""))) %>% "
"0","  mutate(Shark_Sum_Abundance= ifelse(Atoll %in% ""Egmont"", 6.9, ifelse(Atoll %in% ""Salomon"", 4.8, ifelse(Atoll %in% ""Peros Banhos"", 3.233333, ifelse(Atoll %in% ""Brothers"", 2.9, 3.1)))))"
"0",""
"0","dovs.wide$Shark_Abundance <- factor(dovs.wide$Shark_Abundance,levels = c(""Low"", ""Medium"", ""High"")) # reorder"
"0",""
"0","dovs.wide$Atoll <- factor(dovs.wide$Atoll,levels = c(""Nelsons Island"", ""Brothers"", ""Peros Banhos"", ""Salomon"", ""Egmont"")) # reorder"
"0",""
"0","dovs.wide$Shark_Sum_Abundance <-as.numeric(dovs.wide$Shark_Sum_Abundance)"
"0",""
"0",""
"0",""
"0","#### Filter out Lagoon Sites ####"
"0","dovs.wide.reef <- dovs.wide %>%"
"0","  filter(!OpCode_transect %in% c(""BIOT_7097_DOV_6_Salomon_N_20190311.T1"",""BIOT_7097_DOV_6_Salomon_N_20190311.T2"",""BIOT_7097_DOV_6_Salomon_N_20190311.T3"",""BIOT_7097_DOV_6_Salomon_N_20190311.T4"",""BIOT_7097_DOV_7_PerosBanhos_Lagoon_20190303.T1"",""BIOT_7097_DOV_7_PerosBanhos_Lagoon_20190303.T2"",""BIOT_7097_DOV_7_PerosBanhos_Lagoon_20190303.T3"",""BIOT_7097_DOV_7_PerosBanhos_Lagoon_20190303.T4""))%>% "
"0","  select_if(negate(function(col) is.numeric(col) && sum(col) < 1)) # get rid of any species that don't occur in the dataset"
"0",""
"0",""
"0",""
"0","#### Long Data ####"
"0","dovs.long.reef <- reshape2::melt(dovs.wide.reef, id.vars=c('Year','Atoll', 'Location', ""Site"", ""OpCode_transect"",""OpCode_Site"", ""OpCode"", ""Shark_Abundance"", ""Shark_Sum_Abundance""), value.name= ""Abundance"", variable.name= ""Full.Species.Name"")"
"0",""
"0","# Add family to dovs.long.reef"
"0","dovs.long.reef <- dovs.long.reef %>% mutate(Family= word(dovs.long.reef$Full.Species.Name, 1))"
"0",""
"0","# Reorder"
"0","dovs.long.reef <- dovs.long.reef %>% "
"0","  dplyr::select(OpCode_transect, Year:Site, OpCode,OpCode_Site, Shark_Abundance,"
"0","                Shark_Sum_Abundance, Family, "
"0","                Full.Species.Name, Abundance)"
"0",""
"0","dovs.wide.reef <- dovs.wide.reef %>% "
"0","  dplyr::select(OpCode_transect, Year, Atoll, Location, Site,"
"0","                OpCode, OpCode_Site, Shark_Abundance, Shark_Sum_Abundance,"
"0","                ""Unidentified baitfish"":""Zanclidae Zanclus cornutus"") "
"0",""
"0","# Create a dataset with the lagoonal sites"
"0","dovs.wide # has the lagoonal sites"
