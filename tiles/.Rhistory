ggtitle("a) Overall")+
scale_colour_hue(h = c(180, 300))
p_corals_overall
# Top
colnames(corals.2021_wide)
meancorals.top <- corals.2021_wide %>%
group_by(Treatment) %>%
summarise(sum= sum(Top),
mean=mean(Top),
se=std.error(Top))
p_corals_top <- ggplot(meancorals.top, aes(x=Treatment, y=mean, col=Treatment)) +
geom_pointrange(size=1, aes(ymin=mean-se, ymax= mean+se)) +
theme_pubr(base_size=16) +
theme(axis.text.x = element_blank(),
legend.position="none") +
labs(y="", x="") +
ggtitle("b) Top")+
scale_colour_hue(h = c(180, 300)) +
geom_text(label="*", x=3.2, y=0.6, size=10, color="black")
p_corals_top
# Bottom
colnames(corals.2021_wide)
meancorals.bottom <- corals.2021_wide %>%
group_by(Treatment) %>%
summarise(sum= sum(Bottom),
mean=mean(Bottom),
se=std.error(Bottom))
p_corals_bottom <- ggplot(meancorals.bottom, aes(x=Treatment, y=mean, col=Treatment)) +
geom_pointrange(size=1, aes(ymin=mean-se, ymax= mean+se)) +
theme_pubr(base_size=16) +
theme(axis.text.x = element_blank(),
legend.position="none") +
labs(y="", x="") +
ggtitle("c) Bottom")+
scale_colour_hue(h = c(180, 300)) +
geom_text(label="*", x=3.2, y=0.45, size=10, color="black")
p_corals_bottom
# Side
colnames(corals.2021_wide)
meancorals.side <- corals.2021_wide %>%
group_by(Treatment) %>%
summarise(sum= sum(Side),
mean=mean(Side),
se=std.error(Side))
p_corals_side <- ggplot(meancorals.side, aes(x=Treatment, y=mean, col=Treatment)) +
geom_pointrange(size=1, aes(ymin=mean-se, ymax= mean+se)) +
theme_pubr(base_size=16) +
theme(axis.text.x = element_blank(),
legend.position="none") +
labs(y="", x="") +
ggtitle("d) Side")+
scale_colour_hue(h = c(180, 300))
p_corals_side
test <- ggarrange(p_corals_top,
p_corals_side,
p_corals_bottom)
test
p_coral <- ggarrange(p_corals_overall, test,
ncol=2, common.legend=TRUE,
widths=c(2,3))
p_coral
ggsave(p_coral, file="../figures/coral-means.png",
height=5, width=10)
save(p_coral, file="../data/created-data/coral-means.RData")
p_corals_overall <- ggplot(meancorals.overall, aes(x=Treatment, y=mean, col=Treatment)) +
geom_pointrange(size=1, aes(ymin=mean-se, ymax= mean+se)) +
theme_pubr(base_size=16) +
theme(axis.text.x = element_blank(),
legend.position="none") +
labs(y="Coral Recruitment (+/- se)", x="") +
ggtitle("a) Overall")+
scale_colour_hue(h = c(180, 300))
p_corals_overall
# Overall
colnames(corals.2021_wide)
meancorals.overall <- corals.2021_wide %>%
group_by(Treatment) %>%
summarise(sum= sum(All.Corals),
mean=mean(All.Corals),
se=std.error(All.Corals))
p_corals_overall <- ggplot(meancorals.overall, aes(x=Treatment, y=mean, col=Treatment)) +
geom_pointrange(size=1, aes(ymin=mean-se, ymax= mean+se)) +
theme_pubr(base_size=16) +
theme(axis.text.x = element_blank(),
legend.position="none") +
labs(y="Coral Recruitment (+/- se)", x="") +
ggtitle("a) Overall")+
scale_colour_hue(h = c(180, 300))
p_corals_overall
# Top
colnames(corals.2021_wide)
meancorals.top <- corals.2021_wide %>%
group_by(Treatment) %>%
summarise(sum= sum(Top),
mean=mean(Top),
se=std.error(Top))
p_corals_top <- ggplot(meancorals.top, aes(x=Treatment, y=mean, col=Treatment)) +
geom_pointrange(size=1, aes(ymin=mean-se, ymax= mean+se)) +
theme_pubr(base_size=16) +
theme(axis.text.x = element_blank(),
legend.position="none") +
labs(y="", x="") +
ggtitle("b) Top")+
scale_colour_hue(h = c(180, 300)) +
geom_text(label="*", x=3.2, y=0.6, size=10, color="black")
p_corals_top
# Bottom
colnames(corals.2021_wide)
meancorals.bottom <- corals.2021_wide %>%
group_by(Treatment) %>%
summarise(sum= sum(Bottom),
mean=mean(Bottom),
se=std.error(Bottom))
p_corals_bottom <- ggplot(meancorals.bottom, aes(x=Treatment, y=mean, col=Treatment)) +
geom_pointrange(size=1, aes(ymin=mean-se, ymax= mean+se)) +
theme_pubr(base_size=16) +
theme(axis.text.x = element_blank(),
legend.position="none") +
labs(y="", x="") +
ggtitle("c) Bottom")+
scale_colour_hue(h = c(180, 300)) +
geom_text(label="*", x=3.2, y=0.45, size=10, color="black")
p_corals_bottom
# Side
colnames(corals.2021_wide)
meancorals.side <- corals.2021_wide %>%
group_by(Treatment) %>%
summarise(sum= sum(Side),
mean=mean(Side),
se=std.error(Side))
p_corals_side <- ggplot(meancorals.side, aes(x=Treatment, y=mean, col=Treatment)) +
geom_pointrange(size=1, aes(ymin=mean-se, ymax= mean+se)) +
theme_pubr(base_size=16) +
theme(axis.text.x = element_blank(),
legend.position="none") +
labs(y="", x="") +
ggtitle("d) Side")+
scale_colour_hue(h = c(180, 300))
p_corals_side
test <- ggarrange(p_corals_top,
p_corals_side,
p_corals_bottom)
test
p_coral <- ggarrange(p_corals_overall, test,
ncol=2, common.legend=TRUE,
widths=c(2,3))
p_coral
ggsave(p_coral, file="../figures/coral-means.png",
height=5, width=10)
save(p_coral, file="../data/created-data/coral-means.RData")
# Overall
colnames(corals.2021_wide)
meancorals.overall <- corals.2021_wide %>%
group_by(Treatment) %>%
summarise(sum= sum(All.Corals),
mean=mean(All.Corals),
se=std.error(All.Corals))
p_corals_overall <- ggplot(meancorals.overall, aes(x=Treatment, y=mean, col=Treatment)) +
geom_pointrange(size=1, aes(ymin=mean-se, ymax= mean+se)) +
theme_pubr(base_size=16) +
theme(axis.text.x = element_blank(),
legend.position="none") +
labs(y="Coral Recruitment (+/- SE)", x="") +
ggtitle("a) Overall")+
scale_colour_hue(h = c(180, 300))
p_corals_overall
# Top
colnames(corals.2021_wide)
meancorals.top <- corals.2021_wide %>%
group_by(Treatment) %>%
summarise(sum= sum(Top),
mean=mean(Top),
se=std.error(Top))
p_corals_top <- ggplot(meancorals.top, aes(x=Treatment, y=mean, col=Treatment)) +
geom_pointrange(size=1, aes(ymin=mean-se, ymax= mean+se)) +
theme_pubr(base_size=16) +
theme(axis.text.x = element_blank(),
legend.position="none") +
labs(y="", x="") +
ggtitle("b) Top")+
scale_colour_hue(h = c(180, 300)) +
geom_text(label="*", x=3.2, y=0.6, size=10, color="black")
p_corals_top
# Bottom
colnames(corals.2021_wide)
meancorals.bottom <- corals.2021_wide %>%
group_by(Treatment) %>%
summarise(sum= sum(Bottom),
mean=mean(Bottom),
se=std.error(Bottom))
p_corals_bottom <- ggplot(meancorals.bottom, aes(x=Treatment, y=mean, col=Treatment)) +
geom_pointrange(size=1, aes(ymin=mean-se, ymax= mean+se)) +
theme_pubr(base_size=16) +
theme(axis.text.x = element_blank(),
legend.position="none") +
labs(y="", x="") +
ggtitle("c) Bottom")+
scale_colour_hue(h = c(180, 300)) +
geom_text(label="*", x=3.2, y=0.45, size=10, color="black")
p_corals_bottom
# Side
colnames(corals.2021_wide)
meancorals.side <- corals.2021_wide %>%
group_by(Treatment) %>%
summarise(sum= sum(Side),
mean=mean(Side),
se=std.error(Side))
p_corals_side <- ggplot(meancorals.side, aes(x=Treatment, y=mean, col=Treatment)) +
geom_pointrange(size=1, aes(ymin=mean-se, ymax= mean+se)) +
theme_pubr(base_size=16) +
theme(axis.text.x = element_blank(),
legend.position="none") +
labs(y="", x="") +
ggtitle("d) Side")+
scale_colour_hue(h = c(180, 300))
p_corals_side
test <- ggarrange(p_corals_top,
p_corals_side,
p_corals_bottom)
test
p_coral <- ggarrange(p_corals_overall, test,
ncol=2, common.legend=TRUE,
widths=c(2,3))
p_coral
ggsave(p_coral, file="../figures/coral-means.png",
height=5, width=10)
save(p_coral, file="../data/created-data/coral-means.RData")
library(tidyverse);library(ggpubr);library(janitor);library(vegan);library(plotrix)
# raw data
data <- read.csv("../data/raw-data/Chagos_November2021_Data_QAQC_Tiles-lab coral_CoralCheck_RRC_Final.xlsx - Chagos_November2021_Data_QAQC_T.csv",stringsAsFactors = FALSE,na.strings=c("","NA"))
# metadata
metadata <- read.csv("../data/raw-data/BIOT_March2019_Data_QAQC-tiles.csv",stringsAsFactors = FALSE,na.strings=c("","NA"))
# Raw Data
View(data)
View(metadata) #221 tiles
# We want to pull out the transect for each tile (all the other columns are filled in from the metadata)
transect <- metadata %>%
mutate(Tile_Treatment = paste(Tag_number, Treatment, sep= ".")) %>%
dplyr::select(Transect, Tile_Treatment)
transect$Transect <- as.character(transect$Transect)
# Clean up the data
corals.2021 <- data %>%
dplyr::select(-c(Treatment_ABC, "Is.it.a.coral.":"Final.Decision",X)) %>% # get rid of silly columns
dplyr::filter(Tube_ID != "81") %>% # get rid of the water sample
mutate(Coral = ifelse(Tube_ID == "None", NA, 1)) %>% # new column to calculate corals
mutate(Tile_position = ifelse(Tile_side. %in%
c("Top?", "Top", "Side/Top", "Top/side", "Side/top"), "Top",
ifelse(Tile_side. %in% c("Bottom?", "Bottom", "Side/Bottom", "Bottom/side", "Side/bottom", "bottom/side", "Bottom (side??)", "Bottom ", "Botttom "), "Bottom",
ifelse(Tile_side. %in% c("Side", "Side/bottom/top", "Side/Top/bottom", "Top/side/bottom"), "Side", "NA")))) %>% # keep these ones for now, but can always change our definition
mutate(Tile_Treatment = paste(Tile, Treatment, sep= ".")) %>%
left_join(transect, by= "Tile_Treatment") %>%
# add in the transect column
dplyr::select(Date, Island, Site, Transect, Tile, Treatment, Tile_Treatment, Tube_ID, Tile_side., Tile_position, Diameter, Coral, Coral_size_bin, Notes) # reorder the columns
corals.2021 %>%
group_by(Treatment) %>%
summarize(Coral.sum = sum(Coral, na.rm= TRUE))
# this is the total number of corals per tile, no matter where they are found on the tile
# Caged	54
# Partial	31
# Uncaged	50
corals.2021 %>%
filter(Tile_side. %in% c("Top?", "Top", "Side/Top", "Top/side", "Side/top")) %>%
group_by(Treatment) %>%
summarize(Coral.sum = sum(Coral, na.rm= TRUE))
# way more corals on the top in caged tiles than uncaged tiles
corals.2021 %>%
filter(Tile_side. %in% c("Bottom?", "Bottom", "Side/Bottom", "Bottom/side", "Side/bottom", "bottom/side", "Bottom (side??)", "Bottom ", "Botttom ")) %>%
group_by(Treatment) %>%
summarize(Coral.sum = sum(Coral, na.rm= TRUE))
# way more corals on the bottom in the uncaged tiles
corals.2021 %>%
filter(Tile_side. %in% c("Side", "Side/bottom/top", "Side/Top/bottom", "Top/side/bottom")) %>%
group_by(Treatment) %>%
summarize(Coral.sum = sum(Coral, na.rm= TRUE))
# simmilar amounts on both the caged and uncaged on the sides
corals.2021 %>%
group_by(Island, Site, Tile, Treatment) %>%
summarize(Coral.sum = sum(Coral, na.rm= TRUE))
corals.2021 %>%
filter(Tile_side. %in% c("Top?", "Top", "Side/Top", "Top/side", "Side/top")) %>%
group_by(Treatment) %>%
summarize(Coral.sum = sum(Coral, na.rm= TRUE))
# Create a wide dataframe
corals.2021_wide <- corals.2021 %>%
pivot_wider(names_from = Tile_position, values_from= Coral, values_fill=0) %>%
dplyr::select(-c(Tube_ID:Notes, "NA")) %>%
group_by(Date, Island,Transect, Site, Tile, Treatment, Tile_Treatment) %>%
summarise_each(funs(sum)) %>% # this adds up each row with the same tile/treatment
filter(Tile_Treatment != "14.Uncaged") %>% # filter out 14 uncaged because it was found flipped and it looked like the bottom and the top were the same in terms of percent cover
mutate(All.Corals = Top + Bottom + Side)
dim(corals.2021_wide)
View(corals.2021_wide)
save(corals.2021_wide, file="../data/created-data/corals.2021_wide.Rdata")
# Create a long dataframe
corals.2021_long <- corals.2021_wide %>%
pivot_longer(-c(Date:Tile_Treatment, All.Corals), names_to= "Tile_position", values_to= "Coral")
View(corals.2021_long)
mean(corals.2021_wide$All.Corals)
# 0.6197183
sd(corals.2021_wide$All.Corals)
# 1.06885
range(corals.2021_wide$All.Corals)
# [1] 0 6
corals.2021_wide %>%
group_by(Treatment) %>%
summarize(sample.size= n())
#
# Caged	92
# Partial	32
# Uncaged	89
corals.2021_wide %>%
group_by(Treatment) %>%
summarize(mean.corals = mean(All.Corals),
sd=sd(All.Corals))
# Caged	0.5760870
# Partial	0.9687500
# Uncaged	0.5393258
corals.2021_wide %>%
group_by(Treatment) %>%
summarize(mean.corals = mean(Top,
sd=sd(Top)))
corals.2021_wide %>%
group_by(Treatment) %>%
summarize(mean.corals = mean(Side,
sd=sd(Side)))
corals.2021_wide %>%
group_by(Treatment) %>%
summarize(mean.corals = mean(Bottom,
sd=sd(Bottom)))
load(file = "../../dovs/data/created/fish.site.tiles.average.RData") # fish.site.tiles.average
load("../../bruvs/data/created/mean.sum.shark.abundance.tiles.RData") # mean.shark.abundance.tiles
load("../../grazing/data/bite.data.RData") # herbivore.bites.site
# Make the names match
test <- corals.2021_wide %>%
mutate(Tile.Site= ifelse(Site == "Il lubine", "Il Lubine",
ifelse(Site == "Il de rats", "Il de rats",
ifelse(Site == "Nelson", "Nelson",
ifelse(Site == "Middle Brother", "Middle Brother",
ifelse(Site == "Il Anglaise Lagoon", "Salomon lagoon",
ifelse(Site == "Il Anglaise Seaward", "Salomon seaward",
ifelse(Site == "Il Poule Lagoon", "Peros Banhos Lagoon", "Peros Banhos Seaward"))))))))
# Make the names match
test2 <- herbivore.bites.site %>%
mutate(Tile.Site= ifelse(Site == "Il Lubine", "Il Lubine",
ifelse(Site == "Il de rats", "Il de rats",
ifelse(Site == "Nelson", "Nelson",
ifelse(Site == "Middle Brother", "Middle Brother",
ifelse(Site == "Il Anglaise Lagoon", "Salomon lagoon",
ifelse(Site == "Il Anglaise Seaward", "Salomon seaward","Peros Banhos Seaward"))))))) %>%
dplyr::select(-c(Site))
# Join shark abundance and fish
consumer.metadata <- fish.site.tiles.average %>%
mutate(Shark_Abundance= ifelse(Atoll %in% "Egmont", "High",
ifelse(Atoll %in% "Salomon", "Medium", "Low"))) %>%
mutate(Shark_Sum_Abundance= ifelse(Atoll %in% "Egmont", 6.9,
ifelse(Atoll %in% "Salomon", 4.8,
ifelse(Atoll %in% "Peros Banhos", 3.8,
ifelse(Atoll %in% "Brothers", 2.9, 3.1)))))
# Join the dataframes
corals.fishes_wide <- left_join(test, consumer.metadata,  by="Tile.Site") %>%
left_join(test2, by="Tile.Site")
save(corals.fishes_wide, file="../data/created-data/corals.fishes_wide.Rdata")
# Create a long dataframe
corals.fishes_long <- corals.fishes_wide %>%
pivot_longer(-c(Date:Tile_Treatment, All.Corals:bites.per.min.mean), names_to= "Tile_position", values_to= "Coral")
library(lme4)
library(lattice)
library(MASS)
require(pscl) # alternatively can use package ZIM for zero-inflated models
library(lmtest)
library(GLMMadaptive) # mixed models that are zero inflated
library(glmmTMB)
library(lsmeans)
library(DHARMa)
library(dplyr)
#devtools::install_github("mtorchiano/effsize")
library(effsize)
library(piecewiseSEM)
library(devtools)
#install_github("jslefche/piecewiseSEM@devel", build_vignette = TRUE)
############
# Overall Corals
############
meancorals.treatment <- corals.2021_long %>%
group_by(Treatment) %>%
summarise(sum= sum(Coral),
mean=mean(Coral),
se=std.error(Coral))
meancorals.treatment
p_overall <- meancorals.treatment %>% ggplot(aes(x= Treatment, y=mean)) +
geom_bar(position = "dodge", stat='identity')+
geom_errorbar(aes(ymin=mean-se, ymax=mean+se), width=.2,
position=position_dodge(.9)) +
labs(y="Coral abundance (mean +/- se)") +
theme_pubr(base_size= 16) +
theme(legend.position = "right")
p_overall
ggsave(file= "../figures/overall.png",
plot=p_overall,
height= 7,
width= 10)
############
# Overall- Tile Position
############
meancorals <- corals.2021_long %>%
group_by(Treatment, Tile_position) %>%
summarise(sum= sum(Coral),
mean=mean(Coral),
se=std.error(Coral)) %>%
mutate_if(is.character, as.factor) %>%
mutate(Tile_position=fct_relevel(Tile_position,c("Top","Bottom","Side")))
library(viridis)
p_corals <- meancorals %>% ggplot(aes(x= Treatment, y=mean, fill= Tile_position)) +
geom_bar(position = "dodge", stat='identity')+
geom_errorbar(aes(ymin=mean-se, ymax=mean+se), width=.2,
position=position_dodge(.9)) +
labs(y="Coral abundance (mean +/- se)", fill= "Tile Position") +
theme_pubr(base_size= 16) +
theme(legend.position = "right") +
scale_fill_viridis(discrete=TRUE)
p_corals
ggsave(file= "../figures/overall-corals.png",
plot=p_corals,
height= 7,
width= 10)
############
# By Site
############
meancorals <- corals.2021_long %>%
group_by(Site, Treatment) %>%
summarise(sum= sum(Coral),
mean=mean(Coral),
se=std.error(Coral))
p_coralsXsite <- meancorals %>%
ggplot(aes(x= Treatment, y=mean)) +
geom_bar(position = "dodge", stat='identity')+
geom_errorbar(aes(ymin=mean-se, ymax=mean+se), width=.2,
position=position_dodge(.9)) +
theme_pubr() +
facet_wrap(~ Site)
p_coralsXsite
ggsave(file= "../figures/coralsXsite.pdf",
plot=p_coralsXsite,
height= 7,
width= 9)
############
# By Site- Position
############
meancorals <- corals.2021_long %>%
group_by(Site, Treatment, Tile_position) %>%
summarise(sum= sum(Coral),
mean=mean(Coral),
se=std.error(Coral))
p_coralsXsite <- meancorals %>%
ggplot(aes(x= Treatment, y=mean, fill= Tile_position)) +
geom_bar(position = "dodge", stat='identity')+
geom_errorbar(aes(ymin=mean-se, ymax=mean+se), width=.2,
position=position_dodge(.9)) +
theme_pubr() +
facet_wrap(~ Site)
p_coralsXsite
ggsave(file= "../figures/coralsXsiteXposition.pdf",
plot=p_coralsXsite,
height= 7,
width= 9)
############
# Coral Size
############
corals.2021 %>%
group_by(Treatment, Coral_size_bin) %>%
count()
corals.2021 %>% ggplot(aes(x= Treatment, fill=Coral_size_bin)) +
geom_bar(position="fill") +
theme_pubr(base_size= 16) +
theme(legend.position = "right")
# Overall
colnames(corals.2021_wide)
meancorals.overall <- corals.2021_wide %>%
group_by(Treatment) %>%
summarise(sum= sum(All.Corals),
mean=mean(All.Corals),
se=std.error(All.Corals))
p_corals_overall <- ggplot(meancorals.overall, aes(x=Treatment, y=mean, col=Treatment)) +
geom_pointrange(size=1, aes(ymin=mean-se, ymax= mean+se)) +
theme_pubr(base_size=16) +
theme(axis.text.x = element_blank(),
legend.position="none") +
labs(y="Coral Recruitment (+/- SE)", x="") +
ggtitle("a) Overall")+
scale_colour_hue(h = c(180, 300))
p_corals_overall
# Top
colnames(corals.2021_wide)
meancorals.top <- corals.2021_wide %>%
group_by(Treatment) %>%
summarise(sum= sum(Top),
mean=mean(Top),
se=std.error(Top))
library(glmmTMB)
library(tidyverse)
library(vegan)
library(ggpubr)
library(dplyr)
library(ggplot2)
library(vegan)
library(ggordiplots)
library(plotly)
library(piecewiseSEM)
library(lme4)
library(glmmTMB)
library(DHARMa)
library(emmeans)
